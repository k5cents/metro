---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  comment = "#>",
  fig.path = "man/figures/README-",
  fig.height = 4,
  fig.width = 9,
  out.width = "100%",
  dpi = 300
)
if (!interactive()) {
  options(width = 95)
}
```

# metro <img src='man/figures/logo.png' align="right" height="139" />

<!-- badges: start -->
[![Lifecycle: experimental][life_badge]][life_link]
[![CRAN status][cran_badge]][cran_link]
[![Codecov test coverage][cov_badge]][cov_link]
[![R build status][ga_badge]][ga_link]
<!-- badges: end -->

The goal of metro is to return data frames from the Washington Metropolitan Area
Transit Authority API. Nested lists have been converted to [tidy] data frames
when possible.

## Installation

You can install the development version of metro from [GitHub][gh]:

```{r install, eval=FALSE}
# install.packages("devtools")
devtools::install_github("kiernann/metro")
```

## Key

Usage of the WMATA API requires a developer API key. Such a key can be obtained
by creating a developer account and subscribing to the free default tier.

The WMATA also provides a [demo key][demo] to try out the various features of
the API. This key should **never** be used in production, it is rate limited and
subject to change at any time.

As of February 2021, the demo key can be used like this:

```{r key}
Sys.setenv("WMATA_KEY" = "e13626d03d8e4c03ac07f95541b3091b")
```

## Example

```{r library}
library(metro)
```

Functions return data frames for easy analysis.

```{r rail_stations}
rail_stations(LineCode = "RD")
```

Use coordinates to find station entrances or bus stops near a location. 

```{r rail_entrance}
# White House coordinates
rail_entrance(Lat = 38.8979, Lon = -77.0365, Radius = 500)
```

Dates use the UTC time zone but times use EST. Times are represented using the
[`hms`][hms] class, which counts the seconds since midnight (sometimes this
means AM times are over 24 hours).

```{r bus_position}
bus_position(RouteId = "L2")
```

```{r rail_times}
rail_times(StationCode = "A07")
```

Functions that always return the same data have that data saved as objects.

```{r lines}
metro_stops # bus_stops() for live
```

<!-- refs: start -->
[life_badge]: https://img.shields.io/badge/lifecycle-experimental-orange.svg
[life_link]: https://lifecycle.r-lib.org/articles/stages.html
[cran_badge]: https://www.r-pkg.org/badges/version/metro
[cran_link]: https://CRAN.R-project.org/package=metro
[ga_badge]: https://github.com/kiernann/metro/workflows/R-CMD-check/badge.svg
[ga_link]: https://github.com/kiernann/metro/actions
[cov_badge]: https://codecov.io/gh/kiernann/metro/branch/master/graph/badge.svg
[cov_link]: https://codecov.io/gh/kiernann/metro?branch=master
[tidy]: https://en.wikipedia.org/wiki/Tidy_data
[gh]: https://github.com/kiernann/metro
[demo]: https://developer.wmata.com/products/5475f236031f590f380924ff
[hms]: https://github.com/tidyverse/hms/issues/28
<!-- refs: end -->
